---
title: "Comparative Impact of Weather Events on Indicators of Human and Economic Health"
author: "David Levy"
date: "11/18/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Synopsis

This analysis makes use of the NOAA Storm Database and attempts to answer some basic questions about severe weather events. More specifically, we are seeking answers to the following:


**Research Questions:**

1. *Across the United States, which types of events (as indicated in the \color{red}{\verb|EVTYPE|}`EVTYPE` variable) are most harmful with respect to population health?*

2. *Across the United States, which types of events have the greatest economic consequences?*


In order to answer these questions, we begin by importing the NOAA Storm Database and vizualizing its contents. We proceed to outline which variables we intend to utilize and which are not helpful in addressing the research questions posed above. Next, we provide R code demonstrating out data paring and transformation process, and proceed to our analysis and results.

The analysis conducted here is brief, but informative. We group and summarize data by event type with injuries and fatalities as variables of interest in assessing the effect of various types of weather events on population health (Research Question 1). Next, we group and summarize data by event type with property damage and crop damage as variables of interest in assessing the economic consequences of various types of weather events (Research Question 2).

We conclude our analysis and results with graphical representations of the data and a summary of findings that will allow other researchers to develop further research questions related to the effects of weather events on human and economic health.


## Data Processing

#### R Packages Used for Analysis

```{r Calling analysis libraries}

library(tidyverse)
library(ggplot2)

```

#### Unzipping and Reading Data

We begin data processing by unzipping and reading the compressed Storm Data data file into memory:

```{r Unzipping and reading data, cache=TRUE}

# store data file name
dataFile  <- 'repdata_data_StormData.csv.bz2'

# download the file if it doesn't exist already
if(!file.exists(dataFile)) {
    download.file('https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2',
                  destfile = dataFile, method = 'curl')
}

# initiate a connection to the data file
bzConnection <- bzfile(dataFile)

# initiate tibble with file contents
stormData <- read.csv(bzConnection)

```

In order to better understand the data set as it has been provided, we can visualize the top and bottom of our new tibble and get a printout of the structure of the data:

```{r Inspecting the data frame}

# visualize the top of the tibble
head(stormData)

# visualize the bottom of the tibble
tail(stormData)

# summarize the structure of the tibble
str(stormData)

```

#### Data Processing and Transformations

Based on what we observed in the previous section, this data set is bit unwieldy in terms of its width, meaning that we likely have more variables than we need in order to answer the two questions emphasized in the **Synopsis** section. Recall that of particular interest are the `EVTYPE` and its relationship with indicators of (1) population health and (2) economic consequences. Below is a summary of how each variable has been treated in this analysis and a brief rationale for each respective decision:

- `STATE__`   : We will drop this variable. It is redundant and we do not need a numerical representation of the state of storm events for the present analysis.
- `BGN_DATE`  : We will drop this variable. There are no questions pertaining to the temporal aspects of the storm events recorded in this data set.
- `BGN_TIME`  : We will drop this variable. There are no questions pertaining to the temporal aspects of the storm events recorded in this data set.
- `TIME_ZONE` : We will drop this variable. There are no questions pertaining to the temporal aspects of the storm events recorded in this data set.
- `COUNTY`    : We will drop this variable. There are no questions pertaining to spatial aspects of the storm events recorded in this data set.
- `COUNTYNAME`: We will drop this variable. There are no questions pertaining to spatial aspects of the storm events recorded in this data set.
- `STATE`     : We will retain this variable for our analysis. A within-state comparison may be germane to questions of economic impact.
- `EVTYPE`    : We will retain this variable for our analysis. This variable is central to the questions at hand, as both are asked within the framework of of event type.
- `BGN_RANGE` : We will drop this variable. It does not contain information germane to the questions at hand.
- `BGN_AZI`   : We will drop this variable. It does not contain information germane to the questions at hand.
- `BGN_LOCATI`: We will drop this variable. It does not contain information germane to the questions at hand.
- `END_DATE`  : We will drop this variable. There are no questions pertaining to the temporal aspects of the storm events recorded in this data set.
- `END_TIME`  : We will drop this variable. There are no questions pertaining to the temporal aspects of the storm events recorded in this data set.
- `COUNTY_END`: We will drop this variable. It does not contain information germane to the questions at hand.
- `COUNTYENDN`: We will drop this variable. It does not contain information germane to the questions at hand.
- `END_RANGE` : We will drop this variable. It does not contain information germane to the questions at hand.
- `END_AZI`   : We will drop this variable. It does not contain information germane to the questions at hand.
- `END_LOCATI`: We will drop this variable. It does not contain information germane to the questions at hand.
- `LENGTH`    : We will drop this variable. It does not contain information germane to the questions at hand.
- `WIDTH`     : We will drop this variable. It does not contain information germane to the questions at hand.
- `F`         : We will drop this variable. It does not contain information germane to the questions at hand.
- `MAG`       : We will drop this variable. It does not contain information germane to the questions at hand.
- `FATALITIES`: We will retain this variable for our analysis. Fatalities are an important measure of the impact of storms on population health.
- `INJURIES`  : We will retain this variable for our analysis. Injuries are an important measure of the impact of storms on population health.
- `PROPDMG`   : We will retain this variable for our analysis, as it contains a numerical representation (without an order of magnitude) of the property damage caused by the corresponding storm event. Property damage is an important measure of the economic toll taken by storms.
- `PROPDMGEXP`: We will retain this variable for our analysis, as it contains an indication of the order of magnitude of the property damage caused by the corresponding storm event (H,K,M B correspond with hundred, thousand, million and billions respectively). Property damage is an important measure of the economic toll taken by storms.
- `CROPDMG`   : We will retain this variable for our analysis, as it contains a numerical representation (without an order of magnitude) of the crop damage caused by the corresponding storm event. Crop damage is an important measure of the economic toll taken by storms.
- `CROPDMGEXP`: We will retain this variable for our analysis, as it contains an indication of the order of magnitude of the crop damage caused by the corresponding storm event (H,K,M B correspond with hundred, thousand, million and billions respectively). Crop damage is an important measure of the economic toll taken by storms.
- `WFO`       : We will drop this variable. It does not contain information germane to the questions at hand.
- `STATEOFFIC`: We will drop this variable. It does not contain information germane to the questions at hand.
- `ZONENAMES` : We will drop this variable. It does not contain information germane to the questions at hand.
- `LATITUDE`  : We will drop this variable. It does not contain information germane to the questions at hand.
- `LONGITUDE` : We will drop this variable. It does not contain information germane to the questions at hand.
- `LATITUDE_E`: We will drop this variable. It does not contain information germane to the questions at hand.
- `LONGITUDE_`: We will drop this variable. It does not contain information germane to the questions at hand.
- `REMARKS`   : We will drop this variable. It does not contain information germane to the questions at hand.
- `REFNUM`    : We will drop this variable. It does not contain information germane to the questions at hand.

Now that we have summarized how we intend to use (or not use) each variable in the data set, we can transform data appropriately:

```{r Data processing and transformations}

# data transformations and column selections
stormDataFinal <- stormData %>%
    mutate(
        propertydamage = ifelse(grepl("H", PROPDMGEXP), PROPDMG * 10^2, # H means hundreds
                         ifelse(grepl("K", PROPDMGEXP), PROPDMG * 10^3, # K means thousands
                         ifelse(grepl("M", PROPDMGEXP), PROPDMG * 10^6, # M means millions
                         ifelse(grepl("B", PROPDMGEXP), PROPDMG * 10^9, # B means billions
                         PROPDMG)))),                                   # otherwise, no transformation
        cropdamage   =   ifelse(grepl("H", CROPDMGEXP), CROPDMG * 10^2, # H means hundreds
                         ifelse(grepl("K", CROPDMGEXP), CROPDMG * 10^3, # K means thousands
                         ifelse(grepl("M", CROPDMGEXP), CROPDMG * 10^6, # M means millions
                         ifelse(grepl("B", CROPDMGEXP), CROPDMG * 10^9, # B means billions
                         CROPDMG))))                                    # otherwise, no transformation
        ) %>%
    select(state = STATE, event = EVTYPE, fatalities = FATALITIES,
           injuries = INJURIES, propertydamage, cropdamage) # take only relevant variables

# visualize the new data set
head(stormDataFinal, n=20)
```
Now our data looks usable, so we can proceed to analysis and results in order to answer our research questions.



## Results

There should be a section titled Results in which your results are presented.
You may have other sections in your analysis, but Data Processing and Results are required.
The analysis document must have at least one figure containing a plot.
Your analysis must have no more than three figures. Figures may have multiple plots in them (i.e. panel plots), but there cannot be more than three figures total.
You must show all your code for the work in your analysis document. This may make the document a bit verbose, but that is okay. In general, you should ensure that \color{red}{\verb|echo = TRUE|}echo = TRUE for every code chunk (this is the default setting in knitr).
